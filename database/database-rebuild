-- SAFE CREATE TYPE: only if it doesn't exist
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'account_type_enum') THEN
        CREATE TYPE account_type_enum AS ENUM ('User', 'Admin', 'Guest');
    END IF;
END$$;

-- SAFE CREATE TABLE: account
CREATE TABLE IF NOT EXISTS account (
    account_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(100) NOT NULL,
    account_type account_type_enum DEFAULT 'User'
);

-- SAFE CREATE TABLE: classification
CREATE TABLE IF NOT EXISTS classification (
    classification_id SERIAL PRIMARY KEY,
    classification_name VARCHAR(50) NOT NULL
);

-- SAFE CREATE TABLE: inventory
CREATE TABLE IF NOT EXISTS inventory (
    inv_id SERIAL PRIMARY KEY,
    inv_make VARCHAR(50) NOT NULL,
    inv_model VARCHAR(50) NOT NULL,
    inv_description TEXT,
    inv_image VARCHAR(200),
    inv_thumbnail VARCHAR(200),
    classification_id INT REFERENCES classification(classification_id)
);

-- INSERT DATA: classification (avoid duplicates)
INSERT INTO classification (classification_name)
SELECT 'Sport' WHERE NOT EXISTS (SELECT 1 FROM classification WHERE classification_name='Sport');
INSERT INTO classification (classification_name)
SELECT 'Truck' WHERE NOT EXISTS (SELECT 1 FROM classification WHERE classification_name='Truck');
INSERT INTO classification (classification_name)
SELECT 'SUV' WHERE NOT EXISTS (SELECT 1 FROM classification WHERE classification_name='SUV');

-- INSERT DATA: inventory (avoid duplicates by make/model)
INSERT INTO inventory (inv_make, inv_model, inv_description, inv_image, inv_thumbnail, classification_id)
SELECT 'GM', 'Hummer', 'small interiors, very strong engine', '/images/hummer.jpg', '/images/hummer_thumb.jpg', 3
WHERE NOT EXISTS (SELECT 1 FROM inventory WHERE inv_make='GM' AND inv_model='Hummer');

INSERT INTO inventory (inv_make, inv_model, inv_description, inv_image, inv_thumbnail, classification_id)
SELECT 'Toyota', 'Supra', 'fast and stylish sports car', '/images/supra.jpg', '/images/supra_thumb.jpg', 1
WHERE NOT EXISTS (SELECT 1 FROM inventory WHERE inv_make='Toyota' AND inv_model='Supra');

INSERT INTO inventory (inv_make, inv_model, inv_description, inv_image, inv_thumbnail, classification_id)
SELECT 'Ford', 'F-150', 'powerful truck with towing', '/images/f150.jpg', '/images/f150_thumb.jpg', 2
WHERE NOT EXISTS (SELECT 1 FROM inventory WHERE inv_make='Ford' AND inv_model='F-150');

INSERT INTO inventory (inv_make, inv_model, inv_description, inv_image, inv_thumbnail, classification_id)
SELECT 'BMW', 'M3', 'classic sport performance car', '/images/m3.jpg', '/images/m3_thumb.jpg', 1
WHERE NOT EXISTS (SELECT 1 FROM inventory WHERE inv_make='BMW' AND inv_model='M3');

-- TASK #4: Update GM Hummer description
UPDATE inventory
SET inv_description = REPLACE(inv_description, 'small interiors', 'a huge interior')
WHERE inv_make = 'GM' AND inv_model = 'Hummer';

-- TASK #6: Update image paths
UPDATE inventory
SET inv_image = REPLACE(inv_image, '/images/', '/images/vehicles/'),
    inv_thumbnail = REPLACE(inv_thumbnail, '/images/', '/images/vehicles/');
